ร
    Vgiร
  รฃ                   รณ  โ U d Z ddlmZmZ ddlmZ ddlm Z mZ ddl	Z	ddl
m
Z
mZm
Z
  eeยซ      Z eeยซ        e	j                   d dยซ      Z e	j                   d	d
ยซ      Z	  e eeยซ      Zeed
<    edยซ        ed
eโบ ยยซ       ej/                  ddgยฌยซ      dโ ยซ       Zej/                  ddgยฌยซ      dโ ยซ       Zedk(  r. e e	j                   ddยซ      ยซ      Zej9                  dedยฌยซ       yy# e$ rZ edeโบ ยยซ       โ dZ[ww xY w)zj
BloomSense Questionnaire API
Flask backend for fetching neurodiversity screening questions from Supabase
รฉ    )รFlaskร jsonify)รCORS)ร
create_clientรClientN)รListรDictรAnyรSUPABASE_URLz(https://irqqfedhzzxysdiowuft.supabase.coรSUPABASE_KEYzรeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlycXFmZWRoenp4eXNkaW93dWZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MDkwMDksImV4cCI6MjA3OTE4NTAwOX0.lf4PAQiqSCcBXJQ1nJCvfkENoUl4nLLHx47a74wvd1cรsupabaseu,   รขลโ Supabase client initialized successfullyz   URL: u*   รขลโ Failed to initialize Supabase client: z/api/questionnaire/questionsรGET)ร methodsc                  รณr  โ 	 t        dยซ       t        j                  dยซ      j                   dยซ      j	                  ddยฌยซ      j
                  ยซ       } t        d | j                  duโบ d	| j                  rt        | j                  ยซ      nd
โบ ยยซ       | j                  r.t        d
| j                  t        | j                  ยซ      dลยซ      d
fS t        dยซ       t        d
g d
ddลยซ      d
fS # t        $ rH}t        |ยซ      }t        d|โบ ยยซ       d
dl
}|j                  ยซ        t        d|ddลยซ      dfcY d}~S d}~ww xY w)zi
    Fetch all questions from the questionaire table
    Returns questions ordered by question_order
    z#Fetching questions from Supabase...รquestionairezDquestion_id, question_text, question_order, max_score, critical_itemรquestion_orderF)รdescz"Supabase response received. Data: Nz	, Count: r   T)ร successร	questionsรcountรฉร   z'Warning: No questions found in databasezNo questions found)r   r   r   ร messagezError fetching questions: z'Failed to fetch questions from database)r   รerrorr   iรด  )
รprintr
   รtableรselectรorderร executeรdataรlenr   ร	Exceptionรstrร	tracebackร	print_exc)รresponseรeร	error_msgr#   s       รบโฆC:\Users\UMAIMA MEHMOOD\Desktop\BloomSense\AI-assisted-neurodiversity-screening-platform-main\backend\bloomsense_questionnaire_api.pyรget_questionnaire_questionsr)      sW  โฌ รฐ"ร
ร3ร4รคโ>โ>ย.ร1ร
โฐVรZร
[ร
โฐUร#ยจ%หUร
0ร
โฐWโนYรฐ  	รด
 	ร2ยฐ8ยท=ยฑ=รร3Lร2MรYรmuรmzรmzรWZร[cร[hร[hรWiรฐ  ABรฐ  WCรฐ  Dรด  	Eร
ย=ล=รรร%ลธ]โข]รหXลธ]โข]ร+รฑ รณ รฐ รฐ	รฐ 
รด 
ร;ร<รรรรร/รฑ	รณ รฐ
 รฐ
รฐ 
รธรด รฒ 	รหโFห	ร
ร*ยจ9ยจ+ร6ร7รรรรรรรรร@รฑ 
รณ 
รฐ 
รฐ	รต 	รปรฐ
	รบs$   โCC% รC% ร%	D6ร.=D1ร+D6ร1D6z/api/questionnaire/healthc                  รณ"   โ t        dddลยซ      dfS )zHealth check endpointรokzBloomSense Questionnaire API)รstatusร servicer   )r   ยฉ รณ    r(   รhealth_checkr0   H   s&   โฌ รด รร1รฑรณ  รฐ 	รฐ รฐ r/   ร__main__รPORTiห  z 0.0.0.0T)รhostรportรdebug)ร __doc__รflaskr   r   ร
flask_corsr   r
   r   r    รosรtypingr   r	   r
   ร__name__รappรgetenvr
   r   ร__annotations__r   r!   r&   รrouter)   r0   รintr4   รrunr.   r/   r(   รบ<module>rB      s3  รฐรฒรท
 !ร ร *ร 	ร "ร "รก
หHฦoโฌร โฌSโ	รฐ หrยyโฐyหร)SรTโฌรหrยyโฐyหรฐ  *|รณ  }โฌรฐ
ร$ย\ยฐ<ร@โฌHหfร@ร	ร8ร:ร	หGยLย>ร
"ร#รฐ โกยร
)ยฐEยฐ7โฌร;รฑ'รณ <รฐ'รฐT โกยร
&ยฐยฐ โฌร8รฑรณ 9รฐรฐ หzรรฑ หyหrยyโฐyหยร&ร
'โฌDร โกGยGยยยจTโฌGร2รฐ	 รธรฐs รฒ 
ร	ร6ยฐqยฐcร
:ร;ร	รปรฐ
รบs   ร!C( ร(C>ร-C9ร9C>